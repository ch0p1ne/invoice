<UserControl x:Class="invoice.CustomControls.EditUserForm"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:invoice.CustomControls"
             mc:Ignorable="d" 
             xmlns:subviewmodels="clr-namespace:invoice.ViewModels.SubViewModels"
             d:DataContext="{d:DesignInstance Type=subviewmodels:UsersVM}"
             d:DesignHeight="450" d:DesignWidth="900"
             xmlns:converter="clr-namespace:invoice.Utilities.Converters"
             Width="740"
             Height="425"
             Background="Transparent">

    <!--
    Pseudocode / Plan détaillé (à l'intention des développeurs) :
    1) Objectif : ajouter des animations d'entrée/sortie "material-like" pour le contrôle
       afin qu'il s'anime lorsqu'il est injecté dans l'Overlay de la vue UsersView.
    2) Choix simple : animation d'opacité et translation verticale (Y) du conteneur principal.
    3) Implémentation :
       - Donner un x:Name au Border racine (RootBorder).
       - Mettre son Opacity initial à 0 et ajouter un RenderTransform TranslateTransform.
       - Définir deux Storyboards en ressources : EnterStoryboard et ExitStoryboard.
           * EnterStoryboard : Opacity 0 -> 1, Translate Y 40 -> 0, durée ~220ms, easing.
           * ExitStoryboard  : Opacity 1 -> 0, Translate Y 0 -> 40, durée ~180ms, easing.
       - Lancer EnterStoryboard sur l'événement Loaded via EventTrigger.
       - Fournir les Storyboards en tant que ressources publiques (nommées) pour que la vue hôte
         puisse démarrer ExitStoryboard si nécessaire (ex : UsersView.BeginStoryboard).
    4) Contraintes :
       - Ne pas modifier la structure visuelle existante ; ne changer que les propriétés
         du conteneur principal et ajouter des ressources/trigger.
       - Conserver la palette et styles définis dans le fichier initial.
    5) Résultat : contrôle autonome qui s'anime proprement lorsqu'il apparaît dans l'overlay.
    -->

    <UserControl.Resources>
        <converter:BoolToInvertValue x:Key="BoolToInvertValue"/>
        <!-- Animation Storyboards -->
        <Storyboard x:Key="EnterStoryboard">
            <!-- Opacity -->
            <DoubleAnimation Storyboard.TargetName="RootBorder"
                             Storyboard.TargetProperty="Opacity"
                             From="0" To="1"
                             Duration="0:0:0.22">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>

            <!-- Translate Y -->
            <DoubleAnimation Storyboard.TargetName="RootBorder"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             From="40" To="0"
                             Duration="0:0:0.22">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="ExitStoryboard">
            <!-- Opacity -->
            <DoubleAnimation Storyboard.TargetName="RootBorder"
                             Storyboard.TargetProperty="Opacity"
                             From="1" To="0"
                             Duration="0:0:0.18">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>

            <!-- Translate Y -->
            <DoubleAnimation Storyboard.TargetName="RootBorder"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                             From="0" To="40"
                             Duration="0:0:0.18">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Style x:Key="GenericOperationBtn" TargetType="Button">
            <Setter Property="Width" Value="100"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Background" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="LightGray"/>
                    <Setter Property="BorderBrush" Value="Gray"/>
                    <Setter Property="Foreground" Value="Gray"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="CancelOperationBtn" TargetType="Button">
            <Setter Property="Width" Value="100"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="LightGray"/>
                    <Setter Property="BorderBrush" Value="Gray"/>
                    <Setter Property="Foreground" Value="Gray"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Border x:Name="RootBorder"
            CornerRadius="20"
            BorderThickness="2"
            BorderBrush="AliceBlue"
            Background="{StaticResource SurfaceWhite}"
                Padding="35,20"
            Opacity="1"
            RenderTransformOrigin="0.5,0.5">
        <!-- Local DropShadow definition (inline to avoid resource lookup issues) -->
        <Border.RenderTransform>
            <TranslateTransform Y="40"/>
        </Border.RenderTransform>

        <Border.Effect>
            <DropShadowEffect Color="#F6F6F6" BlurRadius="15" ShadowDepth="2" Direction="270" />
        </Border.Effect>

        <!-- Démarrer l'animation d'entrée lors du Loaded -->
        <Border.Triggers>
            <EventTrigger RoutedEvent="Border.Loaded">
                <BeginStoryboard Storyboard="{StaticResource EnterStoryboard}" />
            </EventTrigger>
        </Border.Triggers>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>

            <TextBlock Text="Modification"
                       Grid.Row="0"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="{StaticResource PrimaryBlue}"
                       Margin="4,0,0,16"/>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>

                <!-- left -->
                <StackPanel Grid.Row="0" Orientation="Vertical" VerticalAlignment="Top" HorizontalAlignment="Stretch" Width="235">
                    <!-- Nom -->
                    <TextBlock Text="Nom d'utilisateur" Style="{StaticResource FieldLabel}"/>
                    <TextBox Style="{StaticResource MaterialTextBox}" x:Name="LastNameTextBox" 
                             Margin="0,2,0,8" Text="{Binding UserName, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Prénom -->
                    <TextBlock Text="Nom complet" Style="{StaticResource FieldLabel}"
                               />
                    <TextBox Style="{StaticResource MaterialTextBox}" x:Name="FirstNameTextBox"
                             Margin="0,2,0,8" Text="{Binding FullName}"/>

                    <!-- Mot de passe -->
                    <TextBlock Text="Mot de passe" Style="{StaticResource FieldLabel}"/>
                    <PasswordBox Style="{StaticResource MaterialPasswordBox}" x:Name="PasswordBox"
                                 Margin="0,2,0,8" />

                </StackPanel>
                <!-- right -->
                <StackPanel Grid.Column="1" 
                            VerticalAlignment="Top"
                            HorizontalAlignment="Stretch"
                            Margin="75,0,0,0"
                            Width="285">

                    <!-- E-mail -->
                    <TextBlock Text="E-mail" Style="{StaticResource FieldLabel}"/>
                    <TextBox Style="{StaticResource MaterialTextBox}" x:Name="EmailTextBox" 
                             Margin="0,2,0,8" Text="{Binding Email}"/>

                    <!-- Numéro de portable -->
                    <TextBlock Text="Numéro de télephone" Style="{StaticResource FieldLabel}"/>
                    <TextBox Style="{StaticResource MaterialTextBox}" x:Name="PhoneTextBox" 
                             Margin="0,2,0,8" Text="{Binding Phone, UpdateSourceTrigger=PropertyChanged}"/>
                    <!-- Rôles -->
                    <TextBlock Text="Rôle" Style="{StaticResource FieldLabel}"/>
                    <ComboBox Template="{DynamicResource MaterialComboBox1}" Style="{StaticResource MaterialComboBox}" x:Name="RoleTextBox" 
                              Text="{Binding SelectedRole.Role_name}"
                             Margin="0,2,0,8"
                              ItemsSource="{Binding AvailableRoles}"
                                SelectedItem="{Binding SelectedRole}"
                             >
                    </ComboBox>
                </StackPanel>
            </Grid>

            <!-- Checkbox for activate account-->
            <StackPanel Orientation="Horizontal"
                        Grid.Row="2"
                        Margin="10,0,0,8">

                <!-- Activé le compte à la création-->
                <CheckBox x:Name="IsActifCheckBox"
                          Style="{DynamicResource MaterialCheckBox}"
                          IsChecked="{Binding IsActivateAccountIsCheck}">Activé le compte à la création ?</CheckBox>

            </StackPanel>

            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="Annuler"
                        Margin="0,0,10,0"
                        Command="{Binding ClearInputFieldsCommand}"
                        Style="{StaticResource CancelOperationBtn}"
                        IsEnabled="{Binding IsOperationDone, Converter={StaticResource BoolToInvertValue}}"
                        />
                <Button Content="Modifier"
                        Style="{StaticResource GenericOperationBtn}"
                        Margin="0,0,10,0"
                        IsEnabled="{Binding IsOperationDone, Converter={StaticResource BoolToInvertValue}}"
                        Command="{Binding EditUserCommand}"
                        />
                <Button Content="Terminer"
                        Style="{StaticResource GenericOperationBtn}"
                        Command="{Binding ResetOperationFlagCommand}"
                        Click="CancelButton_Click"
                        IsEnabled="{Binding IsOperationDone}"/>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
