<UserControl x:Class="invoice.Views.CreateFactureTwo"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converters="clr-namespace:invoice.Utilities.Converters"
             xmlns:paymentmethod="clr-namespace:invoice.Utilities"
             xmlns:local="clr-namespace:invoice.Views"
             xmlns:System="clr-namespace:System;assembly=mscorlib"
             xmlns:viewModels="clr-namespace:invoice.ViewModels"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance Type=viewModels:CreateFactureVM}"
             d:DesignHeight="450" d:DesignWidth="800"
             Language="fr-FR"
             Style="{StaticResource Page_Style}"
             >
    <UserControl.Resources>
        <converters:DiscountFormatConverter x:Key="DiscountFormatConverter" />

        <BooleanToVisibilityConverter  x:Key="BooleanToVisibilityConverter"/>
        <ObjectDataProvider x:Key="PrioriteData"
                        MethodName="GetValues"
                        ObjectType="{x:Type System:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="paymentmethod:PaymentMethod" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />

        </Grid.RowDefinitions>
        <Grid.Resources>
            
            <Style x:Key="txtLabeled" TargetType="TextBlock">
                <Setter Property="FontWeight" Value="Light" />
                <Setter Property="Foreground" Value="#1F1F1F" />
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="Margin" Value="0,0,50,0" />
                <Setter Property="FontSize" Value="14" />
            </Style>

            <Style x:Key="txtTotal" TargetType="TextBlock">
                <Setter Property="Foreground" Value="#000000" />
                <Setter Property="Background" Value="#F7F7F7" />
                <Setter Property="HorizontalAlignment" Value="Right" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontWeight" Value="Normal" />
                <Setter Property="Padding" Value="30,5" />
            </Style>
            <Style x:Key="rdoRemise" TargetType="RadioButton">
                <Setter Property="Height" Value="24" />
                <Setter Property="Width" Value="24" />
                <Setter Property="Template" >
                    <Setter.Value>
                        <ControlTemplate TargetType="RadioButton">
                            <Grid>

                                <Ellipse Fill="{TemplateBinding Background}"
                                 Name="RoundShape"
                                 Cursor="Hand"
                                 Stroke="{TemplateBinding BorderBrush}"
                                 StrokeThickness="{TemplateBinding BorderThickness}">

                                </Ellipse>

                                <ContentPresenter   HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Content="{TemplateBinding Content}" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="RoundShape" Property="Fill" Value="#CFEFE0"/>
                                </Trigger>

                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="RoundShape" Property="Fill" Value="#2a9d8f"/>
                                </Trigger>

                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="RoundShape" Property="Fill" Value="LightGray"/>
                                    <Setter Property="Foreground" Value="Gray"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>

            </Style>
            
            <!--<DataTemplate DataType="ComboBox" x:Key="SelectedValueDisplayTemplate">
                <TextBlock Text="{Binding ExamenName}" />
            </DataTemplate>-->
        </Grid.Resources>

        <StackPanel Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Center">
            <WrapPanel Margin="130,5,0,0">
                <Button Margin="0,0,10,0" Style="{StaticResource buttonCircleStyle}"
                        Command="{Binding ChangeCurrentViewCommand}"
                        CommandParameter="crudCreateOne"
                        Width="24"
                        Height="24">
                    <Image Source="/Assets/icons/arrow-left.png" Height="24"/>
                </Button>
                <Border Height="35"
                    Width="5"
                    Background="#404040">

                </Border>
                <TextBlock Text="Detail de la facture" VerticalAlignment="Center"
                       FontSize="25"
                       Margin="20,0,0,0"
                       FontFamily="{StaticResource fontSen}"/>
            </WrapPanel>
        </StackPanel>

        <StackPanel Grid.Row="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="80" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal"                       
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Margin="130,10,0,0">
                    <TextBlock Style="{StaticResource txtLabeled}" Text="Motif(s)" 
                               FontWeight="Normal"
                               Margin="0,0,15,0"/>
                    <Button Style="{StaticResource buttonCircleStyle}"
                            Height="32"
                            Command="{Binding AddInvoiceExamCommand}">
                        <Image Source="/Assets/icons/add.png"  />
                    </Button>
                    <StackPanel Margin="10,0,0,0" Orientation="Horizontal" VerticalAlignment="Center">
                        <WrapPanel >
                            <Image Source="/Assets/icons/exam_soft.png" Height="32" Margin="0,0,10,0" />
                            <ComboBox Width="285" 
                                      Height="24"
                                      ItemsSource="{Binding AvailableExamens}"
                                      SelectedItem="{Binding SelectedAvailableExam, Mode=TwoWay}"
                                      MaxDropDownHeight="150"
                                      BorderThickness="0,0,0,1"
                                      VerticalContentAlignment="Center"
                                      Background="Transparent"
                                      
                                      >
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom">
                                            <Rectangle Fill="#008A38" Width="4" Height="8" Margin="0,2,5,2" />
                                            <ContentControl VerticalAlignment="Center"
                                                            Content="{Binding ExamenName}"
                                                            FontSize="14"/> 
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <ComboBox Width="85" 
                                      Height="24"
                                      Margin="10,0,0,0"
                                      HorizontalContentAlignment="Center"
                                      ItemsSource="{Binding AvailableExamens}"
                                      SelectedItem="{Binding SelectedAvailableExam, Mode=TwoWay}"
                                      MaxDropDownHeight="155"
                                      BorderThickness="0,0,0,1"
                                      VerticalContentAlignment="Center"
          
          >
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom">
                                            <Rectangle Fill="DarkMagenta" Width="4" Height="8" Margin="0,2,5,2" />
                                            <ContentControl VerticalAlignment="Center"
                                Content="{Binding Reference}"
                                FontSize="14"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </WrapPanel>
                        <ComboBox Width="50" 
                                  VerticalContentAlignment="Center"
                                  HorizontalContentAlignment="Center"
                                  Height="24"
                                  ItemsSource="{Binding QtyAvailable}"
                                  SelectedItem="{Binding SelectedQty, Mode=TwoWay}"
                                  HorizontalAlignment="Right"
                                  Margin="15,0,0,0">

                        </ComboBox>
                    </StackPanel>

                </StackPanel>

                <StackPanel Grid.Row="1" Margin="105,0,105,0">
                    <ListView ItemsSource="{Binding InvoiceExams, Mode=TwoWay}">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid >
                                    <Grid.Style>
                                        <Style TargetType="Grid">
                                        </Style>
                                    </Grid.Style>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="300" />
                                        <ColumnDefinition Width="75" />
                                        <ColumnDefinition Width="150" />
                                        <ColumnDefinition Width="175" />
                                        <ColumnDefinition Width="250" />
                                    </Grid.ColumnDefinitions>
                                    <ScrollViewer HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden">
                                        <TextBlock VerticalAlignment="Center" HorizontalAlignment="Right" Background="LightYellow" FontSize="12" FontWeight="SemiBold" Padding="10,1" Text="{Binding Exam.ExamenName}" Grid.Column="0" Style="{StaticResource txtLabeled}" />
                                        
                                    </ScrollViewer>
                                    <TextBlock HorizontalAlignment="Right"  Text="{Binding Qty}" Grid.Column="1" Style="{StaticResource txtLabeled}" 
                                               FontWeight="SemiBold"/>
                                    <TextBlock HorizontalAlignment="Right" FontWeight="Light" Text="Examen" Grid.Column="2" Style="{StaticResource txtLabeled}" />
                                    <TextBlock Text="{Binding Exam.Price, StringFormat={}{0:N0} fcfa}"
                                               Grid.Column="3"
                                               FontSize="12"
                                               FontWeight="Bold"
                                               Style="{StaticResource txtTotal}" />

                                    <Button  Style="{StaticResource buttonCircleStyle}"
                                             Grid.Column="4"
                                             HorizontalAlignment="Right"
                                             Cursor="Hand"
                                                 Command="{Binding DataContext.removeInvoiceExamCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}, AncestorLevel=2 }}"
                                                 CommandParameter="{Binding}"
                                                    Height="24" 
                                                    Width="24">
                                        <Image Source="/Assets/icons/delete.png"/>
                                    </Button>

                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                        <ListView.Style>
                            <Style TargetType="ListView">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="MaxHeight" Value="250" />
                                <Setter Property="Margin" Value="0,35,0,0" />
                                <Setter Property="BorderThickness" Value="0" />
                                <Setter Property="VerticalContentAlignment" Value="Center" />
                            </Style>
                        </ListView.Style>
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="Margin" Value="0,5,0,0"/>
                                <Setter Property="MaxHeight" Value="35" />
                                
                                <Setter Property="VerticalContentAlignment" Value="Center"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </ListView.ItemContainerStyle>
                    </ListView>
                </StackPanel>
            </Grid>
        </StackPanel>

        <Grid Grid.Row="2" Margin="75,0,50,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" Visibility="{Binding ShowAdvanceInvoiceParam, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <!-- Remise-->
                <StackPanel Grid.Row="0" HorizontalAlignment="Left">
                    <TextBlock Text="Remise" 
                               FontSize="12"
                               Style="{StaticResource FieldLabel}"
                               Margin="5,0,0,3"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Discount percent-->  
                        <TextBox Grid.Column="0"
                                 Name="tbxDiscountAmountPercent"
                                 Style="{StaticResource MaterialTextBox}"
                                 Width="100"
                                 Padding="5,0"
                                 Height="28"
                                    >  
                            <TextBox.Text>
                                <Binding Path="DiscountPercent" Mode="OneWayToSource" UpdateSourceTrigger="PropertyChanged" StringFormat="{}{0:N0}" />
                            </TextBox.Text>
                        </TextBox>
                        <!-- Discount flat--> 
                        <TextBox Grid.Column="0"
                                 Style="{StaticResource MaterialTextBox}"
                                 Name="tbxDiscountAmountFlat"
                                 Visibility="Collapsed"
                                 Width="100"
                                 Padding="5,0"
                                 Height="28"
                                    >  
                            <TextBox.Text>
                                <Binding Path="DiscountFlat" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged" StringFormat="{}{0:N0}" />
                            </TextBox.Text>
                        </TextBox>
                        <WrapPanel Grid.Column="1"
                                   VerticalAlignment="Center"
                                   Margin="10,0,0,0">
                            <RadioButton GroupName="DiscountType"
                                         IsChecked="{Binding SelectedDiscountPercent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Click="RadioButton_Percent_Click"
                                         
                                         Style="{StaticResource rdoRemise}"
                                         Margin="10,0,0,0"
                                         >
                                <TextBlock Text="%" 
                                           FontSize="11" 
                                           Style="{StaticResource FieldLabel}"
                                           Margin="0"
                                           Foreground="Black" 
                                           FontWeight="Bold"/>
                            </RadioButton>
                            <RadioButton GroupName="DiscountType"
                                         IsChecked="{Binding SelectedDiscountFlat, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Click="RadioButton_Flat_Click"
                                         Name="rdoFlat"
                                         Style="{StaticResource rdoRemise}"
                                         Margin="10,0,0,0">
                                <TextBlock Text="CFA" 
                                           FontSize="9" 
                                           Margin="0"
                                           Style="{StaticResource FieldLabel}"
                                           Foreground="Black" 
                                           FontWeight="Bold"/>
                            </RadioButton>
                        </WrapPanel>
                    </Grid>
                </StackPanel>
                <!-- Avance-->
                <StackPanel Grid.Row="1" HorizontalAlignment="Left" Margin="0,5,0,0" Orientation="Horizontal">
                    <StackPanel>
                        <TextBlock Text="Avance" 
                                   FontSize="12"
                                   Margin="5,0,0,3"
                                   Style="{StaticResource FieldLabel}"/>
                        <TextBox Style="{StaticResource MaterialTextBox}"
                                 Padding="5,0"
                                 Height="28"
                                 Width="100"
                                 Tag=" 0 %"
                                 >
                            <TextBox.Text>
                                <Binding Path="AmountPaid" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged" StringFormat="{}{0:N0}" />
                            </TextBox.Text>
                        </TextBox>
                    </StackPanel>
                    <StackPanel Margin="10,0,0,0">
                        <TextBlock Text="Mode de paiement" 
                                   FontSize="12"
                                   Margin="5,0,0,0"
                                   Style="{StaticResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource PrioriteData}}"
                                  SelectedItem="{Binding PaymentMethod}"
                                  DisplayMemberPath="."
                                  MinWidth="100"
                                  Margin="10,5,10,0"/>
                    </StackPanel>
                </StackPanel>
                <!-- Taxes-->
                <StackPanel Orientation="Horizontal" 
                            Grid.Row="2" 
                            HorizontalAlignment="Left"
                            Margin="0,15,0,0"
                            Focusable="False">
                    <TextBlock Text="Taxe applicable :"
                               Style="{StaticResource FieldLabel}"/>
                    <CheckBox Content="CSS" Style="{StaticResource MaterialCheckBox}"
                              Margin="15,0,0,0"
                              IsEnabled="False"
                              IsChecked="{Binding IsCssCheck}"/>
                    <CheckBox Content="TPS" Style="{StaticResource MaterialCheckBox}"
                              Margin="10,0,0,0"
                              IsEnabled="False"
                              IsChecked="{Binding IsTPSCheck}"/>
                </StackPanel>
            </Grid>
            

            <Grid Grid.Column="2" HorizontalAlignment="Right"
                  Width="220">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="3*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock  Grid.Column="0" Style="{StaticResource FieldLabel}" Text="Total HT"
                                FontWeight="Normal"/>
                    <TextBlock  Grid.Column="1" Style="{StaticResource FieldLabel}" 
                                HorizontalAlignment="Right"
                                Text="{Binding TotalHTPrice, StringFormat={}{0:N0} FCFA}"
                                />
                </Grid>
                <Grid Grid.Row="1" Margin="0,4,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="3*" />
                    </Grid.ColumnDefinitions>

                </Grid>
                <Grid Grid.Row="3" Margin="0,4,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="3*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock  Grid.Column="0" Style="{StaticResource FieldLabel}" 
                                Text="Total TTC"
                                FontWeight="Normal"/>
                    <TextBlock  Grid.Column="1" Style="{StaticResource FieldLabel}" 
                                HorizontalAlignment="Right"
                                Text="{Binding TotalTTCPrice, StringFormat={}{0:N0} FCFA}" />
                </Grid>
                <Grid Grid.Row="4" Margin="0,4,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="3*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock  Grid.Column="0" Style="{StaticResource FieldLabel}" 
                                Text="Reste à payer" 
                                FontWeight="Normal"
                                Visibility="{Binding IsShowAmountLeft, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    <TextBlock  Grid.Column="1" Style="{StaticResource FieldLabel}" 
                                HorizontalAlignment="Right"
                                Visibility="{Binding IsShowAmountLeft, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Text="{Binding AmountLeft, StringFormat={}{0:N0} FCFA}" />
                </Grid>
                <Grid Grid.Row="1" Margin="0,6,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="3*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock  Grid.Column="0" Style="{StaticResource FieldLabel}" 
                                Text="Css" 
                                FontSize="10"
                                FontWeight="Normal"/>
                    <TextBlock  Grid.Column="1" Style="{StaticResource FieldLabel}" 
                                HorizontalAlignment="Right"
                                FontSize="10"
                                Text="{Binding CalculateCss, StringFormat={}{0:N0} FCFA}" />
                </Grid>
                <Grid Grid.Row="2" Margin="0,6,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="3*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock  Grid.Column="0" Style="{StaticResource FieldLabel}" 
                                Text="Escompt" 
                                FontSize="10"
                                FontWeight="Normal"/>
                    <TextBlock  Grid.Column="1" Style="{StaticResource FieldLabel}" 
                                HorizontalAlignment="Right"
                                FontSize="10"
                                Text="{Binding CalculateTPS, StringFormat={}{0:N0} FCFA}" />
                </Grid>
                
            </Grid>
        </Grid>


        <Grid Grid.Row="3" 
                    VerticalAlignment="Top" Margin="0,0,105,0"
              HorizontalAlignment="Right"
                    MinHeight="50">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Button Grid.Column="2" Style="{StaticResource GenericOperationBtn}"
                    Height="42"
                    Width="150"
                    FontWeight="Bold"
                    Command="{Binding CreateInvoiceCommand}"
                    Content="Enregistrer">

            </Button>
            <Button Grid.Column="0"
                    Style="{StaticResource GenericOperationBtn}"
                    Background="{StaticResource SurfaceWhite}"
                    Foreground="Black"
                    Margin="0,0,100,0"
                    Height="42"
                    Width="150"
                    Command="{Binding PreviewInvoiceCommand}"
                    FontWeight="Bold"
                    Content="Impression">
                
            </Button>
        </Grid>

    </Grid>
</UserControl>
